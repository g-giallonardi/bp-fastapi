# ğŸ“Œ FastAPI Project Template

## ğŸš€ Introduction
This project is a modular FastAPI template designed to quickly start developing a REST API with authentication, database management, and structured project organization.

---

## ğŸ“‚ Project Structure
```
myproject/  # Replace 'myproject' with your project name
â”œâ”€â”€ README.MD
â”œâ”€â”€ alembic/
â”‚   â”œâ”€â”€ README
â”‚   â”œâ”€â”€ env.py
â”‚   â”œâ”€â”€ script.py.mako
â”‚   â””â”€â”€ versions/
â”œâ”€â”€ alembic.ini
â”œâ”€â”€ api/
â”‚   â””â”€â”€ v1/
â”‚       â”œâ”€â”€ api_v1.py
â”‚       â””â”€â”€ endpoints/
â”‚           â”œâ”€â”€ auth.py      # Example authentication endpoint
â”‚           â”œâ”€â”€ example.py   # Example generic endpoint
â”‚           â”œâ”€â”€ protected.py # Example protected endpoint
â”œâ”€â”€ core/
â”‚   â”œâ”€â”€ config.py
â”‚   â”œâ”€â”€ database.py
â”‚   â””â”€â”€ security.py
â”œâ”€â”€ init_project.py
â”œâ”€â”€ main.py
â”œâ”€â”€ middlewares/
â”‚   â”œâ”€â”€ auth_middleware.py
â”‚   â””â”€â”€ role_middleware.py
â”œâ”€â”€ models/
â”‚   â”œâ”€â”€ base.py
â”‚   â””â”€â”€ user.py
â”œâ”€â”€ requirements.txt
â”œâ”€â”€ schemas/
â”‚   â””â”€â”€ user.py
â”œâ”€â”€ tests/
â”‚   â”œâ”€â”€ test_main.py
â”‚   â”œâ”€â”€ test_auth.py
â”‚   â”œâ”€â”€ test_protected.py
â”‚   â”œâ”€â”€ __init__.py
â”‚â”€â”€ Dockerfile
â””â”€â”€ docker-compose.yml
```

ğŸ“Œ **Note:** The `auth.py`, `example.py`, and `protected.py` endpoints are provided as examples. You can modify or remove them based on your project requirements.

---

## ğŸ›  How to Use the Template
### 1ï¸âƒ£ Clone the repository
```sh
git clone https://github.com/username/myproject.git  # Replace 'myproject' with your project name
cd myproject
```

### 2ï¸âƒ£ Create a virtual environment and install dependencies
```sh
python -m venv venv
source venv/bin/activate  # Linux/Mac
venv\Scripts\activate     # Windows
pip install --upgrade pip
pip install -r requirements.txt
pip install --force-reinstall --no-cache-dir bcrypt
pip install --force-reinstall --no-cache-dir passlib
```

### 3ï¸âƒ£ Initialize the project
Run the initialization script to configure the database, generate a new `SECRET_KEY`, and set up the project:
```sh
python init_project.py myproject  # Replace 'myproject' with your project name
```
This script will also **create two default users**:
- **Admin user**: `admin@example.com` with password `admin123`
- **Normal user**: `user@example.com` with password `password123`

These users are created only if they do not already exist in the database.

### 4ï¸âƒ£ Run the application
```sh
uvicorn main:app --reload  # Replace 'myproject' with your project name
```
The API is accessible at:
- **Swagger UI**: [http://127.0.0.1:8000/docs](http://127.0.0.1:8000/docs)
- **ReDoc**: [http://127.0.0.1:8000/redoc](http://127.0.0.1:8000/redoc)

---

## ğŸ—„ Database Configuration (SQLite, MySQL, PostgreSQL)
By default, the project uses SQLite. To switch to MySQL or PostgreSQL, modify the `.env` file with your database credentials:

**.env file:**
```ini
DB_TYPE=postgresql  # Use 'sqlite', 'mysql', or 'postgresql'
DB_USER=user
DB_PASSWORD=yourpassword
DB_HOST=localhost
DB_NAME=mydatabase
```
The database settings are automatically loaded in `core/config.py`:
```python
import os
from sqlalchemy import create_engine
from sqlalchemy.orm import sessionmaker, declarative_base

DB_USER = os.getenv("DB_USER", "user")
DB_PASSWORD = os.getenv("DB_PASSWORD", "password")
DB_HOST = os.getenv("DB_HOST", "localhost")
DB_NAME = os.getenv("DB_NAME", "bp_fastapi")
DB_TYPE = os.getenv("DB_TYPE", "sqlite")
DATABASE_URL = f"{DB_TYPE}://{DB_USER}:{DB_PASSWORD}@{DB_HOST}/{DB_NAME}"

engine = create_engine(DATABASE_URL)
SessionLocal = sessionmaker(autocommit=False, autoflush=False, bind=engine)
Base = declarative_base()
```

### Apply migrations
If using Alembic, generate and apply migrations:
```sh
alembic revision --autogenerate -m "Initial migration"
alembic upgrade head
```

---

## ğŸ Database Migrations with Alembic
### 1ï¸âƒ£ Initialize Alembic
```sh
alembic init alembic
```
This creates an `alembic/` folder to manage database versions.

### 2ï¸âƒ£ Generate a migration after modifying models
```sh
alembic revision --autogenerate
```

### 3ï¸âƒ£ Apply the migration
```sh
alembic upgrade head
```

### 4ï¸âƒ£ Rollback a migration
```sh
alembic downgrade -1
```

---

## âœ… Testing
The project includes basic tests using `pytest` and `httpx`. Ensure you have installed the required testing dependencies:
```sh
pip install pytest==8.3.4 httpx==0.28.1
```

Run tests with:
```sh
TESTING=True pytest tests/
```

### ğŸ”¹ **Included Tests:**
- **`test_main.py`**: Basic health check of the API.
- **`test_auth.py`**: Tests for user authentication (login success & failure).
- **`test_protected.py`**: Tests access to protected routes using JWT tokens.

Example of running tests:
```sh
pytest tests/
```
If all tests pass, you should see output indicating successful test execution.

---

## ğŸ“œ License
This project is licensed under the MIT License. Free to use and modify. ğŸ‰

